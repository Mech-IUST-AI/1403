# -*- coding: utf-8 -*-
"""plant_disease_detection.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/12pOboc8OL0ib2C22nVr3_78evIl7HBgc

Downloading the datadet
"""

import kagglehub

# Download latest version
path = kagglehub.dataset_download("yogeshwaran005/plant-disease-detection")

print("Path to dataset files:", path)

"""note: I merged the dataset with another dataset of kaggle. The final dataset is the combination of the two datasets in the links below:

1- https://www.kaggle.com/datasets/yogeshwaran005/plants-disease-detection

2- https://www.kaggle.com/datasets/emmarex/plantdisease

Connecting to google drive
"""

from google.colab import drive
drive.mount('/content/drive')

import os
os.listdir("/content/drive/My Drive/plant-disease-detection/Plant Disease Detection")

import os

# Ù…Ø³ÛŒØ± ÙÙˆÙ„Ø¯Ø± Ø§ØµÙ„ÛŒ Ø¯ÛŒØªØ§Ø³Øª Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯
base_path = "/content/drive/My Drive/plant-disease-detection/Plant Disease Detection"

# Ù¾ÛŒÙ…Ø§ÛŒØ´ ÙÙˆÙ„Ø¯Ø±Ù‡Ø§ Ùˆ Ø´Ù…Ø§Ø±Ø´ ØªØµØ§ÙˆÛŒØ± Ø¯Ø± Ù‡Ø± Ù¾ÙˆØ´Ù‡
def count_images_in_folders(base_path):
    if not os.path.exists(base_path):
        print("Invalid base path. Please check the folder path.")
        return

    for plant in sorted(os.listdir(base_path)):
        plant_path = os.path.join(base_path, plant)
        if os.path.isdir(plant_path):
            print(f"\nPlant: {plant}")
            for disease in sorted(os.listdir(plant_path)):
                disease_path = os.path.join(plant_path, disease)
                if os.path.isdir(disease_path):
                    image_count = len([file for file in os.listdir(disease_path) if os.path.isfile(os.path.join(disease_path, file)) and file.lower().endswith(('.jpg', '.png', '.jpeg'))])
                    print(f"  {disease}: {image_count} images")

# Ø§Ø¬Ø±Ø§
count_images_in_folders(base_path)

import os

def display_folder_structure_with_counts(base_path, indent=0):
    if not os.path.exists(base_path):
        print("Invalid base path. Please check the folder path.")
        return

    # Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ ÙÙˆÙ„Ø¯Ø±
    for item in sorted(os.listdir(base_path)):
        item_path = os.path.join(base_path, item)
        if os.path.isdir(item_path):
            print(" " * indent + f"ğŸ“ {item}/")
            display_folder_structure_with_counts(item_path, indent + 4)
        else:
            if item.lower().endswith(('.jpg', '.png', '.jpeg')):
                continue
            print(" " * indent + f"ğŸ“„ {item}")

    # Ø´Ù…Ø§Ø±Ø´ ØªØµØ§ÙˆÛŒØ±
    image_count = len([file for file in os.listdir(base_path)
                       if os.path.isfile(os.path.join(base_path, file)) and file.lower().endswith(('.jpg', '.png', '.jpeg'))])
    if image_count > 0:
        print(" " * indent + f"ğŸ“¸ {image_count} images")

# Ù…Ø³ÛŒØ± ÙÙˆÙ„Ø¯Ø± Ø§ØµÙ„ÛŒ Ø¯ÛŒØªØ§Ø³Øª Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯
base_path = "/content/drive/My Drive/plant-disease-detection/Plant Disease Detection"

# Ø§Ø¬Ø±Ø§
display_folder_structure_with_counts(base_path)

"""preprocess"""

import os
import shutil
import random

# Ù†Ø³Ø¨Øªâ€ŒÙ‡Ø§ÛŒ ØªÙ‚Ø³ÛŒÙ…â€ŒØ¨Ù†Ø¯ÛŒ
test_ratio = 0.15
val_ratio = 0.15

# ØªØ§Ø¨Ø¹ ØªÙ‚Ø³ÛŒÙ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
def split_data_for_plant(plant_path, output_base_path):
    if not os.path.exists(plant_path):
        print("Invalid plant path. Please check the folder path.")
        return

    plant_name = os.path.basename(plant_path)
    output_path = os.path.join(output_base_path, plant_name)
    train_path = os.path.join(output_path, "Train")
    val_path = os.path.join(output_path, "Validation")
    test_path = os.path.join(output_path, "Test")

    for folder in [train_path, val_path, test_path]:
        os.makedirs(folder, exist_ok=True)

    print(f"Processing plant: {plant_name}")
    for disease in sorted(os.listdir(plant_path)):
        disease_path = os.path.join(plant_path, disease)
        if os.path.isdir(disease_path):
            files = [f for f in os.listdir(disease_path)
                     if os.path.isfile(os.path.join(disease_path, f)) and f.lower().endswith(('.jpg', '.png', '.jpeg'))]
            random.shuffle(files)
            total_files = len(files)

            test_count = int(total_files * test_ratio)
            val_count = int(total_files * val_ratio)

            test_files = files[:test_count]
            val_files = files[test_count:test_count + val_count]
            train_files = files[test_count + val_count:]

            for file_set, target_path in zip([train_files, val_files, test_files], [train_path, val_path, test_path]):
                disease_output_path = os.path.join(target_path, disease)
                os.makedirs(disease_output_path, exist_ok=True)
                for file in file_set:
                    shutil.copy(os.path.join(disease_path, file), os.path.join(disease_output_path, file))

            print(f"  {disease}: Train={len(train_files)}, Validation={len(val_files)}, Test={len(test_files)}")

"""Ø§Ø¬Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ§Ù‡ corn"""

# Ù…Ø³ÛŒØ± Ú¯ÛŒØ§Ù‡ Ùˆ ÙÙˆÙ„Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ
corn_path = "/content/drive/My Drive/plant-disease-detection/Plant Disease Detection/Corn"
output_base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data"

# Ø§Ø¬Ø±Ø§
split_data_for_plant(corn_path, output_base_path)

import os

# Ù…Ø³ÛŒØ± ÙÙˆÙ„Ø¯Ø± Ø¯ÛŒØªØ§Ø³Øª ØªÙ‚Ø³ÛŒÙ…â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ§Ù‡ Corn Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯
base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data/Corn"

# Ù¾ÛŒÙ…Ø§ÛŒØ´ ÙÙˆÙ„Ø¯Ø±Ù‡Ø§ÛŒ TrainØŒ Validation Ùˆ Test Ùˆ Ø´Ù…Ø§Ø±Ø´ ØªØµØ§ÙˆÛŒØ±
def check_data_structure(base_path):
    if not os.path.exists(base_path):
        print("Invalid base path. Please check the folder path.")
        return

    for folder in ['Train', 'Validation', 'Test']:
        print(f"\n{folder} folder contents:")
        folder_path = os.path.join(base_path, folder)
        if os.path.isdir(folder_path):
            for disease in sorted(os.listdir(folder_path)):
                disease_path = os.path.join(folder_path, disease)
                if os.path.isdir(disease_path):
                    image_count = len([file for file in os.listdir(disease_path) if os.path.isfile(os.path.join(disease_path, file)) and file.lower().endswith(('.jpg', '.png', '.jpeg'))])
                    print(f"  {disease}: {image_count} images")

# Ø§Ø¬Ø±Ø§
check_data_structure(base_path)

"""data augmentation"""

from tensorflow.keras.preprocessing.image import ImageDataGenerator

# Data Augmentation Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´
train_datagen = ImageDataGenerator(
    rescale=1./255,  # Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾ÛŒÚ©Ø³Ù„â€ŒÙ‡Ø§
    rotation_range=40,  # Ú†Ø±Ø®Ø´ ØªØµØ§ÙˆÛŒØ±
    width_shift_range=0.2,  # ØªØºÛŒÛŒØ± Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¹Ø±Ø¶ÛŒ
    height_shift_range=0.2,  # ØªØºÛŒÛŒØ± Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¹Ù…ÙˆØ¯ÛŒ
    shear_range=0.2,  # Ú†Ø±Ø®Ø´ ØªØµØ§ÙˆÛŒØ±
    zoom_range=0.2,  # Ø¨Ø²Ø±Ú¯â€ŒÙ†Ù…Ø§ÛŒÛŒ
    horizontal_flip=True,  # Ø¨Ø±Ø¹Ú©Ø³ Ú©Ø±Ø¯Ù† ØªØµØ§ÙˆÛŒØ±
    fill_mode='nearest'  # Ù¾Ø± Ú©Ø±Ø¯Ù† Ù¾ÛŒÚ©Ø³Ù„â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ
)

# Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ùˆ ØªØ³Øª ÙÙ‚Ø· Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ…
test_datagen = ImageDataGenerator(rescale=1./255)

# Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
train_generator = train_datagen.flow_from_directory(
    '/content/drive/My Drive/plant-disease-detection/Processed Data/Corn/Train',
    target_size=(224, 224),  # ØªØºÛŒÛŒØ± Ø§Ù†Ø¯Ø§Ø²Ù‡ ØªØµØ§ÙˆÛŒØ±
    batch_size=32,
    class_mode='categorical'  # Ø§Ø² Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
)

validation_generator = test_datagen.flow_from_directory(
    '/content/drive/My Drive/plant-disease-detection/Processed Data/Corn/Validation',
    target_size=(224, 224),
    batch_size=32,
    class_mode='categorical'
)

test_generator = test_datagen.flow_from_directory(
    '/content/drive/My Drive/plant-disease-detection/Processed Data/Corn/Test',
    target_size=(224, 224),
    batch_size=32,
    class_mode='categorical'
)

"""model building"""

from tensorflow.keras.applications import VGG16
from tensorflow.keras import layers, models

# Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„ VGG16 Ø§Ø² Ù¾ÛŒØ´ Ø¢Ù…ÙˆØ²Ø´â€ŒØ¯ÛŒØ¯Ù‡ Ø¨Ø¯ÙˆÙ† Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ
base_model = VGG16(weights='imagenet', include_top=False, input_shape=(224, 224, 3))

# Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ù…Ø¯Ù„
model = models.Sequential()
model.add(base_model)
model.add(layers.Flatten())  # ØµØ§Ù Ú©Ø±Ø¯Ù† ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
model.add(layers.Dense(512, activation='relu'))  # Ù„Ø§ÛŒÙ‡ Fully Connected
model.add(layers.Dense(4, activation='softmax'))  # ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ Ø±Ø§ Ù…Ø·Ø§Ø¨Ù‚ Ø¨Ø§ Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ Ú¯ÛŒØ§Ù‡ÛŒ (Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ 4) ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯

# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø¯Ù„
base_model.trainable = False  # Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¢Ù…ÙˆØ²Ø´ Ù…Ø¬Ø¯Ø¯ Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒØ¢Ù…ÙˆØ²Ø´ Ø¯ÛŒØ¯Ù‡

model.compile(optimizer='adam', loss='categorical_crossentropy', metrics=['accuracy'])

# Ù†Ù…Ø§ÛŒØ´ Ø³Ø§Ø®ØªØ§Ø± Ù…Ø¯Ù„
model.summary()

"""model training"""

history = model.fit(
    train_generator,
    steps_per_epoch=train_generator.samples // train_generator.batch_size,
    epochs=10,
    validation_data=validation_generator,
    validation_steps=validation_generator.samples // validation_generator.batch_size
)

"""Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ù…Ø¯Ù„"""

test_loss, test_acc = model.evaluate(test_generator, steps=test_generator.samples // test_generator.batch_size)
print(f"Test accuracy: {test_acc * 100:.2f}%")

# Ù†Ø§Ù… Ù…Ø®ØµÙˆØµ Ú¯ÛŒØ§Ù‡ Corn
model_name = 'corn_plant_disease_model.h5'

# Ø°Ø®ÛŒØ±Ù‡ Ù…Ø¯Ù„ Ø¨Ø§ Ù†Ø§Ù… Ù…Ø®ØµÙˆØµ Ú¯ÛŒØ§Ù‡
model.save(model_name)

# Ù…Ø³ÛŒØ± Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù…Ø¯Ù„
model_save_path = '/content/drive/My Drive/models/corn_plant_disease_model.h5'

# Ø°Ø®ÛŒØ±Ù‡ Ù…Ø¯Ù„
model.save(model_save_path)

print(f"Model saved at: {model_save_path}")

import os

# Ù…Ø´Ø®Øµ Ú©Ø±Ø¯Ù† ÙÙˆÙ„Ø¯Ø± Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ
model_folder = "/content/drive/My Drive/models"

# Ù„ÛŒØ³Øª Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ Ù¾ÙˆØ´Ù‡
model_files = [f for f in os.listdir(model_folder) if f.endswith('.h5')]

# Ù†Ù…Ø§ÛŒØ´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
print("Model files found:")
for file in model_files:
    print(f"- {file}")

from tensorflow.keras.models import load_model
model = load_model('/content/drive/My Drive/models/corn_plant_disease_model.h5')

import numpy as np
import matplotlib.pyplot as plt
from sklearn.metrics import confusion_matrix
from tensorflow.keras.preprocessing.image import ImageDataGenerator

# Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª
test_datagen = ImageDataGenerator(rescale=1./255)

test_generator = test_datagen.flow_from_directory(
    '/content/drive/My Drive/plant-disease-detection/Processed Data/Corn/Test',
    target_size=(224, 224),
    batch_size=32,
    class_mode='categorical',
    shuffle=False  # Ù…Ù‡Ù…: ØªØ±ØªÛŒØ¨ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ØªØºÛŒÛŒØ± Ù†Ú©Ù†Ø¯
)

# Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù†ØªØ§ÛŒØ¬ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª
y_pred = model.predict(test_generator, steps=test_generator.samples // test_generator.batch_size)
y_pred_classes = np.argmax(y_pred, axis=1)  # ØªØ¨Ø¯ÛŒÙ„ Ø®Ø±ÙˆØ¬ÛŒ Ø¨Ù‡ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø´Ø¯Ù‡

# Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ
y_true = test_generator.classes

# Ø­Ø°Ù Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ Ùˆ Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø¶Ø§ÙÛŒ
y_true = y_true[:len(y_pred_classes)]
y_pred_classes = y_pred_classes[:len(y_true)]

# Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø§ØªØ±ÛŒØ³ Ø³Ø±Ø¯Ø±Ú¯Ù…ÛŒ
cm = confusion_matrix(y_true, y_pred_classes)

# Ø±Ø³Ù… Ù…Ø§ØªØ±ÛŒØ³ Ø³Ø±Ø¯Ø±Ú¯Ù…ÛŒ
plt.figure(figsize=(8, 6))
sns.heatmap(cm, annot=True, fmt='d', cmap='Blues', xticklabels=test_generator.class_indices.keys(), yticklabels=test_generator.class_indices.keys())
plt.xlabel('Predicted')
plt.ylabel('True')
plt.title('Confusion Matrix')
plt.show()

"""ØªØ³Øª Ø¨Ú¯ÛŒØ±ÛŒÙ… :))"""

from google.colab import files
from tensorflow.keras.preprocessing import image
import numpy as np
from tensorflow.keras.models import load_model
import matplotlib.pyplot as plt

# Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
model_path = '/content/drive/My Drive/models/corn_plant_disease_model.h5'
model = load_model(model_path)

# Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ±
uploaded = files.upload()

# Ú¯Ø±ÙØªÙ† Ù†Ø§Ù… ÙØ§ÛŒÙ„ Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡
img_path = next(iter(uploaded))

mg = image.load_img(img_path, target_size=(224, 224))
img_array = image.img_to_array(img)
# Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ùˆ Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´ ØªØµÙˆÛŒØ±
img_array = np.expand_dims(img_array, axis=0)  # ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ø§ Ø§Ø¨Ø¹Ø§Ø¯ (1, 224, 224, 3)
img_array /= 255.0  # Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾ÛŒÚ©Ø³Ù„â€ŒÙ‡Ø§

# Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¨ÛŒÙ…Ø§Ø±ÛŒ Ú¯ÛŒØ§Ù‡
predictions = model.predict(img_array)

# Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬
class_names = ['common_rust', 'grey_leaf_spot', 'healthy', 'northern_leaf_blight']  # Ù„ÛŒØ³Øª Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§
predicted_class = class_names[np.argmax(predictions)]

# Ù†Ù…Ø§ÛŒØ´ ØªØµÙˆÛŒØ±
plt.imshow(img)
plt.title(f"Predicted Disease: {predicted_class}")
plt.axis('off')
plt.show()

print(f"Predicted Disease: {predicted_class}")

"""Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ§Ù‡ Tomato

preprocess
"""

# Ù…Ø³ÛŒØ± Ú¯ÛŒØ§Ù‡ Ùˆ ÙÙˆÙ„Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ
corn_path = "/content/drive/My Drive/plant-disease-detection/Plant Disease Detection/Tomato"
output_base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data"

# Ø§Ø¬Ø±Ø§
split_data_for_plant(corn_path, output_base_path)

import os

# Ù…Ø³ÛŒØ± ÙÙˆÙ„Ø¯Ø± Ø¯ÛŒØªØ§Ø³Øª ØªÙ‚Ø³ÛŒÙ…â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ§Ù‡ Corn Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯
base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data/Tomato"

# Ù¾ÛŒÙ…Ø§ÛŒØ´ ÙÙˆÙ„Ø¯Ø±Ù‡Ø§ÛŒ TrainØŒ Validation Ùˆ Test Ùˆ Ø´Ù…Ø§Ø±Ø´ ØªØµØ§ÙˆÛŒØ±
def check_data_structure(base_path):
    if not os.path.exists(base_path):
        print("Invalid base path. Please check the folder path.")
        return

    for folder in ['Train', 'Validation', 'Test']:
        print(f"\n{folder} folder contents:")
        folder_path = os.path.join(base_path, folder)
        if os.path.isdir(folder_path):
            for disease in sorted(os.listdir(folder_path)):
                disease_path = os.path.join(folder_path, disease)
                if os.path.isdir(disease_path):
                    image_count = len([file for file in os.listdir(disease_path) if os.path.isfile(os.path.join(disease_path, file)) and file.lower().endswith(('.jpg', '.png', '.jpeg'))])
                    print(f"  {disease}: {image_count} images")

# Ø§Ø¬Ø±Ø§
check_data_structure(base_path)

import os
import shutil

# ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù ÙÙˆÙ„Ø¯Ø±Ù‡Ø§ Ùˆ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ Ø¢Ù†Ù‡Ø§
def remove_folders(base_path):
    for folder in ['Train', 'Validation', 'Test']:
        folder_path = os.path.join(base_path, folder)
        if os.path.exists(folder_path):
            shutil.rmtree(folder_path)  # Ø­Ø°Ù ÙÙˆÙ„Ø¯Ø± Ùˆ Ù…Ø­ØªÙˆØ§ÛŒ Ø¯Ø§Ø®Ù„ Ø¢Ù†
            print(f"Deleted {folder} folder.")

# Ù…Ø³ÛŒØ± ÙÙˆÙ„Ø¯Ø± Ø¯ÛŒØªØ§Ø³Øª ØªÙ‚Ø³ÛŒÙ…â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ§Ù‡ Tomato
base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data/Tomato"

# Ø­Ø°Ù ÙÙˆÙ„Ø¯Ø±Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
remove_folders(base_path)

# Ø§Ú©Ù†ÙˆÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú©Ø¯ ØªÙ‚Ø³ÛŒÙ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯:
# Ù†Ø³Ø¨Øªâ€ŒÙ‡Ø§ÛŒ ØªÙ‚Ø³ÛŒÙ…â€ŒØ¨Ù†Ø¯ÛŒ
test_ratio = 0.15
val_ratio = 0.15

# ØªØ§Ø¨Ø¹ ØªÙ‚Ø³ÛŒÙ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
def split_data_for_plant(plant_path, output_base_path):
    if not os.path.exists(plant_path):
        print("Invalid plant path. Please check the folder path.")
        return

    plant_name = os.path.basename(plant_path)
    output_path = os.path.join(output_base_path, plant_name)
    train_path = os.path.join(output_path, "Train")
    val_path = os.path.join(output_path, "Validation")
    test_path = os.path.join(output_path, "Test")

    for folder in [train_path, val_path, test_path]:
        os.makedirs(folder, exist_ok=True)

    print(f"Processing plant: {plant_name}")
    for disease in sorted(os.listdir(plant_path)):
        disease_path = os.path.join(plant_path, disease)
        if os.path.isdir(disease_path):
            files = [f for f in os.listdir(disease_path)
                     if os.path.isfile(os.path.join(disease_path, f)) and f.lower().endswith(('.jpg', '.png', '.jpeg'))]
            random.shuffle(files)
            total_files = len(files)

            test_count = int(total_files * test_ratio)
            val_count = int(total_files * val_ratio)

            test_files = files[:test_count]
            val_files = files[test_count:test_count + val_count]
            train_files = files[test_count + val_count:]

            for file_set, target_path in zip([train_files, val_files, test_files], [train_path, val_path, test_path]):
                disease_output_path = os.path.join(target_path, disease)
                os.makedirs(disease_output_path, exist_ok=True)
                for file in file_set:
                    shutil.copy(os.path.join(disease_path, file), os.path.join(disease_output_path, file))

            print(f"  {disease}: Train={len(train_files)}, Validation={len(val_files)}, Test={len(test_files)}")

# Ù…Ø³ÛŒØ± Ú¯ÛŒØ§Ù‡ Ùˆ ÙÙˆÙ„Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ
corn_path = "/content/drive/My Drive/plant-disease-detection/Plant Disease Detection/Tomato"
output_base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data"

# Ø§Ø¬Ø±Ø§
split_data_for_plant(corn_path, output_base_path)

import os

# Ù…Ø³ÛŒØ± ÙÙˆÙ„Ø¯Ø± Ø¯ÛŒØªØ§Ø³Øª ØªÙ‚Ø³ÛŒÙ…â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ§Ù‡ Tomato
base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data/Tomato"

# ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§Ø±Ø´ ØªØµØ§ÙˆÛŒØ± Ø¯Ø± Ù‡Ø± Ø¯Ø³ØªÙ‡
def check_data_structure(base_path):
    if not os.path.exists(base_path):
        print("Invalid base path. Please check the folder path.")
        return

    for folder in ['Train', 'Validation', 'Test']:
        print(f"\n{folder} folder contents:")
        folder_path = os.path.join(base_path, folder)
        if os.path.isdir(folder_path):
            for disease in sorted(os.listdir(folder_path)):
                disease_path = os.path.join(folder_path, disease)
                if os.path.isdir(disease_path):
                    image_count = len([file for file in os.listdir(disease_path) if os.path.isfile(os.path.join(disease_path, file)) and file.lower().endswith(('.jpg', '.png', '.jpeg'))])
                    print(f"  {disease}: {image_count} images")

# Ø§Ø¬Ø±Ø§
check_data_structure(base_path)

import tensorflow as tf
from tensorflow.keras.applications import MobileNetV2
from tensorflow.keras import layers, models
from tensorflow.keras.preprocessing.image import ImageDataGenerator

# Ù…Ø³ÛŒØ± ÙÙˆÙ„Ø¯Ø±Ù‡Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
train_dir = "/content/drive/My Drive/plant-disease-detection/Processed Data/Tomato/Train"
val_dir = "/content/drive/My Drive/plant-disease-detection/Processed Data/Tomato/Validation"
test_dir = "/content/drive/My Drive/plant-disease-detection/Processed Data/Tomato/Test"

# Ø§ÛŒØ¬Ø§Ø¯ ImageDataGenerators Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒØŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ùˆ ØªØ³Øª
train_datagen = ImageDataGenerator(rescale=1./255, rotation_range=30, width_shift_range=0.2,
                                   height_shift_range=0.2, shear_range=0.2, zoom_range=0.2,
                                   horizontal_flip=True, fill_mode='nearest')

val_datagen = ImageDataGenerator(rescale=1./255)
test_datagen = ImageDataGenerator(rescale=1./255)

train_generator = train_datagen.flow_from_directory(train_dir, target_size=(224, 224), batch_size=32, class_mode='categorical')
val_generator = val_datagen.flow_from_directory(val_dir, target_size=(224, 224), batch_size=32, class_mode='categorical')
test_generator = test_datagen.flow_from_directory(test_dir, target_size=(224, 224), batch_size=32, class_mode='categorical')

# Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„ MobileNetV2 Ø§Ø² Ù¾ÛŒØ´ Ø¢Ù…ÙˆØ²Ø´â€ŒØ¯ÛŒØ¯Ù‡
base_model = MobileNetV2(weights='imagenet', include_top=False, input_shape=(224, 224, 3))

# Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ù…Ø¯Ù„
model = models.Sequential()
model.add(base_model)
model.add(layers.GlobalAveragePooling2D())  # Ú©Ø§Ù‡Ø´ Ø§Ø¨Ø¹Ø§Ø¯ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
model.add(layers.Dense(512, activation='relu'))  # Ù„Ø§ÛŒÙ‡ Fully Connected
model.add(layers.Dense(train_generator.num_classes, activation='softmax'))  # ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ Ù…Ø·Ø§Ø¨Ù‚ Ø¨Ø§ Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§

# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø¯Ù„
base_model.trainable = False  # Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¢Ù…ÙˆØ²Ø´ Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒØ¢Ù…ÙˆØ²Ø´ Ø¯ÛŒØ¯Ù‡

model.compile(optimizer='adam', loss='categorical_crossentropy', metrics=['accuracy'])

# Ø¢Ù…ÙˆØ²Ø´ Ù…Ø¯Ù„
history = model.fit(train_generator, epochs=10, validation_data=val_generator)

# Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ù…Ø¯Ù„ Ø±ÙˆÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª
test_loss, test_accuracy = model.evaluate(test_generator)
print(f"Test accuracy: {test_accuracy * 100:.2f}%")

# Ø°Ø®ÛŒØ±Ù‡ Ù…Ø¯Ù„ Ø¨Ù‡ ØµÙˆØ±Øª HDF5
model.save("/content/drive/My Drive/models/Tomato_plant_disease_model.h5")
print("Model saved successfully!")

import os

# Ù…Ø´Ø®Øµ Ú©Ø±Ø¯Ù† ÙÙˆÙ„Ø¯Ø± Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ
model_folder = "/content/drive/My Drive/models"

# Ù„ÛŒØ³Øª Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ Ù¾ÙˆØ´Ù‡
model_files = [f for f in os.listdir(model_folder) if f.endswith('.h5')]

# Ù†Ù…Ø§ÛŒØ´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
print("Model files found:")
for file in model_files:
    print(f"- {file}")

import numpy as np
import matplotlib.pyplot as plt
from sklearn.metrics import confusion_matrix, ConfusionMatrixDisplay

# Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒâ€ŒÙ‡Ø§
y_pred = model.predict(test_generator)
y_pred_classes = np.argmax(y_pred, axis=1)

# Ø¯Ø±ÛŒØ§ÙØª Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ
y_true = test_generator.classes

# Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¨Ø¹Ø§Ø¯ y_true Ùˆ y_pred_classes
if len(y_true) != len(y_pred_classes):
    print("Mismatch in y_true and y_pred_classes lengths!")
else:
    # Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø§ØªØ±ÛŒØ³ Ø³Ø±Ø¯Ø±Ú¯Ù…ÛŒ
    cm = confusion_matrix(y_true, y_pred_classes)
    class_names = list(test_generator.class_indices.keys())  # Ù†Ø§Ù… Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§

    # Ø±Ø³Ù… Ù…Ø§ØªØ±ÛŒØ³ Ø³Ø±Ø¯Ø±Ú¯Ù…ÛŒ
    disp = ConfusionMatrixDisplay(confusion_matrix=cm, display_labels=class_names)
    disp.plot(cmap=plt.cm.Blues, xticks_rotation="vertical")
    plt.title("Confusion Matrix")
    plt.show()

"""Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ§Ù‡ Rice

preprocessing
"""

# Ù…Ø³ÛŒØ± Ú¯ÛŒØ§Ù‡ Ùˆ ÙÙˆÙ„Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ
corn_path = "/content/drive/My Drive/plant-disease-detection/Plant Disease Detection/Rice"
output_base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data"

# Ø§Ø¬Ø±Ø§
split_data_for_plant(corn_path, output_base_path)

import os

# Ù…Ø³ÛŒØ± ÙÙˆÙ„Ø¯Ø± Ø¯ÛŒØªØ§Ø³Øª ØªÙ‚Ø³ÛŒÙ…â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ§Ù‡ Corn Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯
base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data/Rice"

# Ù¾ÛŒÙ…Ø§ÛŒØ´ ÙÙˆÙ„Ø¯Ø±Ù‡Ø§ÛŒ TrainØŒ Validation Ùˆ Test Ùˆ Ø´Ù…Ø§Ø±Ø´ ØªØµØ§ÙˆÛŒØ±
def check_data_structure(base_path):
    if not os.path.exists(base_path):
        print("Invalid base path. Please check the folder path.")
        return

    for folder in ['Train', 'Validation', 'Test']:
        print(f"\n{folder} folder contents:")
        folder_path = os.path.join(base_path, folder)
        if os.path.isdir(folder_path):
            for disease in sorted(os.listdir(folder_path)):
                disease_path = os.path.join(folder_path, disease)
                if os.path.isdir(disease_path):
                    image_count = len([file for file in os.listdir(disease_path) if os.path.isfile(os.path.join(disease_path, file)) and file.lower().endswith(('.jpg', '.png', '.jpeg'))])
                    print(f"  {disease}: {image_count} images")

# Ø§Ø¬Ø±Ø§
check_data_structure(base_path)

import os
import shutil

# ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù ÙÙˆÙ„Ø¯Ø±Ù‡Ø§ Ùˆ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ Ø¢Ù†Ù‡Ø§
def remove_folders(base_path):
    for folder in ['Train', 'Validation', 'Test']:
        folder_path = os.path.join(base_path, folder)
        if os.path.exists(folder_path):
            shutil.rmtree(folder_path)  # Ø­Ø°Ù ÙÙˆÙ„Ø¯Ø± Ùˆ Ù…Ø­ØªÙˆØ§ÛŒ Ø¯Ø§Ø®Ù„ Ø¢Ù†
            print(f"Deleted {folder} folder.")

# Ù…Ø³ÛŒØ± ÙÙˆÙ„Ø¯Ø± Ø¯ÛŒØªØ§Ø³Øª ØªÙ‚Ø³ÛŒÙ…â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ§Ù‡ Tomato
base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data/Rice"

# Ø­Ø°Ù ÙÙˆÙ„Ø¯Ø±Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
remove_folders(base_path)

# Ø§Ú©Ù†ÙˆÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú©Ø¯ ØªÙ‚Ø³ÛŒÙ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯:
# Ù†Ø³Ø¨Øªâ€ŒÙ‡Ø§ÛŒ ØªÙ‚Ø³ÛŒÙ…â€ŒØ¨Ù†Ø¯ÛŒ
test_ratio = 0.15
val_ratio = 0.15

# ØªØ§Ø¨Ø¹ ØªÙ‚Ø³ÛŒÙ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
def split_data_for_plant(plant_path, output_base_path):
    if not os.path.exists(plant_path):
        print("Invalid plant path. Please check the folder path.")
        return

    plant_name = os.path.basename(plant_path)
    output_path = os.path.join(output_base_path, plant_name)
    train_path = os.path.join(output_path, "Train")
    val_path = os.path.join(output_path, "Validation")
    test_path = os.path.join(output_path, "Test")

    for folder in [train_path, val_path, test_path]:
        os.makedirs(folder, exist_ok=True)

    print(f"Processing plant: {plant_name}")
    for disease in sorted(os.listdir(plant_path)):
        disease_path = os.path.join(plant_path, disease)
        if os.path.isdir(disease_path):
            files = [f for f in os.listdir(disease_path)
                     if os.path.isfile(os.path.join(disease_path, f)) and f.lower().endswith(('.jpg', '.png', '.jpeg'))]
            random.shuffle(files)
            total_files = len(files)

            test_count = int(total_files * test_ratio)
            val_count = int(total_files * val_ratio)

            test_files = files[:test_count]
            val_files = files[test_count:test_count + val_count]
            train_files = files[test_count + val_count:]

            for file_set, target_path in zip([train_files, val_files, test_files], [train_path, val_path, test_path]):
                disease_output_path = os.path.join(target_path, disease)
                os.makedirs(disease_output_path, exist_ok=True)
                for file in file_set:
                    shutil.copy(os.path.join(disease_path, file), os.path.join(disease_output_path, file))

            print(f"  {disease}: Train={len(train_files)}, Validation={len(val_files)}, Test={len(test_files)}")

# Ù…Ø³ÛŒØ± Ú¯ÛŒØ§Ù‡ Ùˆ ÙÙˆÙ„Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ
corn_path = "/content/drive/My Drive/plant-disease-detection/Plant Disease Detection/Rice"
output_base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data"

# Ø§Ø¬Ø±Ø§
split_data_for_plant(corn_path, output_base_path)

import os

# Ù…Ø³ÛŒØ± ÙÙˆÙ„Ø¯Ø± Ø¯ÛŒØªØ§Ø³Øª ØªÙ‚Ø³ÛŒÙ…â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ§Ù‡ Tomato
base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data/Rice"

# ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§Ø±Ø´ ØªØµØ§ÙˆÛŒØ± Ø¯Ø± Ù‡Ø± Ø¯Ø³ØªÙ‡
def check_data_structure(base_path):
    if not os.path.exists(base_path):
        print("Invalid base path. Please check the folder path.")
        return

    for folder in ['Train', 'Validation', 'Test']:
        print(f"\n{folder} folder contents:")
        folder_path = os.path.join(base_path, folder)
        if os.path.isdir(folder_path):
            for disease in sorted(os.listdir(folder_path)):
                disease_path = os.path.join(folder_path, disease)
                if os.path.isdir(disease_path):
                    image_count = len([file for file in os.listdir(disease_path) if os.path.isfile(os.path.join(disease_path, file)) and file.lower().endswith(('.jpg', '.png', '.jpeg'))])
                    print(f"  {disease}: {image_count} images")

# Ø§Ø¬Ø±Ø§
check_data_structure(base_path)

"""data augmentation"""

from tensorflow.keras.preprocessing.image import ImageDataGenerator

# Data Augmentation Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´
train_datagen = ImageDataGenerator(
    rescale=1./255,  # Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾ÛŒÚ©Ø³Ù„â€ŒÙ‡Ø§
    rotation_range=40,  # Ú†Ø±Ø®Ø´ ØªØµØ§ÙˆÛŒØ±
    width_shift_range=0.2,  # ØªØºÛŒÛŒØ± Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¹Ø±Ø¶ÛŒ
    height_shift_range=0.2,  # ØªØºÛŒÛŒØ± Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¹Ù…ÙˆØ¯ÛŒ
    shear_range=0.2,  # Ú†Ø±Ø®Ø´ ØªØµØ§ÙˆÛŒØ±
    zoom_range=0.2,  # Ø¨Ø²Ø±Ú¯â€ŒÙ†Ù…Ø§ÛŒÛŒ
    horizontal_flip=True,  # Ø¨Ø±Ø¹Ú©Ø³ Ú©Ø±Ø¯Ù† ØªØµØ§ÙˆÛŒØ±
    fill_mode='nearest'  # Ù¾Ø± Ú©Ø±Ø¯Ù† Ù¾ÛŒÚ©Ø³Ù„â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ
)

# Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ùˆ ØªØ³Øª ÙÙ‚Ø· Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ…
test_datagen = ImageDataGenerator(rescale=1./255)

# Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
train_generator = train_datagen.flow_from_directory(
    '/content/drive/My Drive/plant-disease-detection/Processed Data/Rice/Train',
    target_size=(224, 224),  # ØªØºÛŒÛŒØ± Ø§Ù†Ø¯Ø§Ø²Ù‡ ØªØµØ§ÙˆÛŒØ±
    batch_size=32,
    class_mode='categorical'  # Ø§Ø² Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
)

validation_generator = test_datagen.flow_from_directory(
    '/content/drive/My Drive/plant-disease-detection/Processed Data/Rice/Validation',
    target_size=(224, 224),
    batch_size=32,
    class_mode='categorical'
)

test_generator = test_datagen.flow_from_directory(
    '/content/drive/My Drive/plant-disease-detection/Processed Data/Rice/Test',
    target_size=(224, 224),
    batch_size=32,
    class_mode='categorical'
)

"""model building"""

from tensorflow.keras.applications import VGG16
from tensorflow.keras import layers, models

# Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„ VGG16 Ø§Ø² Ù¾ÛŒØ´ Ø¢Ù…ÙˆØ²Ø´â€ŒØ¯ÛŒØ¯Ù‡ Ø¨Ø¯ÙˆÙ† Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ
base_model = VGG16(weights='imagenet', include_top=False, input_shape=(224, 224, 3))

# Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ù…Ø¯Ù„
model = models.Sequential()
model.add(base_model)
model.add(layers.Flatten())  # ØµØ§Ù Ú©Ø±Ø¯Ù† ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
model.add(layers.Dense(512, activation='relu'))  # Ù„Ø§ÛŒÙ‡ Fully Connected
model.add(layers.Dense(4, activation='softmax'))  # ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ Ø±Ø§ Ù…Ø·Ø§Ø¨Ù‚ Ø¨Ø§ Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ Ú¯ÛŒØ§Ù‡ÛŒ (Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ 4) ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯

# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø¯Ù„
base_model.trainable = False  # Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¢Ù…ÙˆØ²Ø´ Ù…Ø¬Ø¯Ø¯ Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒØ¢Ù…ÙˆØ²Ø´ Ø¯ÛŒØ¯Ù‡

model.compile(optimizer='adam', loss='categorical_crossentropy', metrics=['accuracy'])

# Ù†Ù…Ø§ÛŒØ´ Ø³Ø§Ø®ØªØ§Ø± Ù…Ø¯Ù„
model.summary()

"""model training"""

history = model.fit(
    train_generator,
    steps_per_epoch=train_generator.samples // train_generator.batch_size,
    epochs=10,
    validation_data=validation_generator,
    validation_steps=validation_generator.samples // validation_generator.batch_size
)

test_loss, test_acc = model.evaluate(test_generator, steps=test_generator.samples // test_generator.batch_size)
print(f"Test accuracy: {test_acc * 100:.2f}%")

# Ù†Ø§Ù… Ù…Ø®ØµÙˆØµ Ú¯ÛŒØ§Ù‡ Corn
model_name = 'Rice_plant_disease_model.h5'

# Ø°Ø®ÛŒØ±Ù‡ Ù…Ø¯Ù„ Ø¨Ø§ Ù†Ø§Ù… Ù…Ø®ØµÙˆØµ Ú¯ÛŒØ§Ù‡
model.save(model_name)

# Ù…Ø³ÛŒØ± Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù…Ø¯Ù„
model_save_path = '/content/drive/My Drive/models/Rice_plant_disease_model.h5'

# Ø°Ø®ÛŒØ±Ù‡ Ù…Ø¯Ù„
model.save(model_save_path)

print(f"Model saved at: {model_save_path}")

import os

# Ù…Ø´Ø®Øµ Ú©Ø±Ø¯Ù† ÙÙˆÙ„Ø¯Ø± Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ
model_folder = "/content/drive/My Drive/models"

# Ù„ÛŒØ³Øª Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ Ù¾ÙˆØ´Ù‡
model_files = [f for f in os.listdir(model_folder) if f.endswith('.h5')]

# Ù†Ù…Ø§ÛŒØ´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
print("Model files found:")
for file in model_files:
    print(f"- {file}")

from tensorflow.keras.models import load_model
model = load_model('/content/drive/My Drive/models/Rice_plant_disease_model.h5')

import numpy as np
import matplotlib.pyplot as plt
from sklearn.metrics import confusion_matrix
from tensorflow.keras.preprocessing.image import ImageDataGenerator

# Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª
test_datagen = ImageDataGenerator(rescale=1./255)

test_generator = test_datagen.flow_from_directory(
    '/content/drive/My Drive/plant-disease-detection/Processed Data/Rice/Test',
    target_size=(224, 224),
    batch_size=32,
    class_mode='categorical',
    shuffle=False  # Ù…Ù‡Ù…: ØªØ±ØªÛŒØ¨ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ØªØºÛŒÛŒØ± Ù†Ú©Ù†Ø¯
)

# Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù†ØªØ§ÛŒØ¬ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª
y_pred = model.predict(test_generator, steps=test_generator.samples // test_generator.batch_size)
y_pred_classes = np.argmax(y_pred, axis=1)  # ØªØ¨Ø¯ÛŒÙ„ Ø®Ø±ÙˆØ¬ÛŒ Ø¨Ù‡ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø´Ø¯Ù‡

# Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ
y_true = test_generator.classes

# Ø­Ø°Ù Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ Ùˆ Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø¶Ø§ÙÛŒ
y_true = y_true[:len(y_pred_classes)]
y_pred_classes = y_pred_classes[:len(y_true)]

# Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø§ØªØ±ÛŒØ³ Ø³Ø±Ø¯Ø±Ú¯Ù…ÛŒ
cm = confusion_matrix(y_true, y_pred_classes)

# Ø±Ø³Ù… Ù…Ø§ØªØ±ÛŒØ³ Ø³Ø±Ø¯Ø±Ú¯Ù…ÛŒ
plt.figure(figsize=(8, 6))
sns.heatmap(cm, annot=True, fmt='d', cmap='Blues', xticklabels=test_generator.class_indices.keys(), yticklabels=test_generator.class_indices.keys())
plt.xlabel('Predicted')
plt.ylabel('True')
plt.title('Confusion Matrix')
plt.show()

"""Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ§Ù‡ wheat

preprocess
"""

# Ù…Ø³ÛŒØ± Ú¯ÛŒØ§Ù‡ Ùˆ ÙÙˆÙ„Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ
corn_path = "/content/drive/My Drive/plant-disease-detection/Plant Disease Detection/Wheat"
output_base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data"

# Ø§Ø¬Ø±Ø§
split_data_for_plant(corn_path, output_base_path)

import os

# Ù…Ø³ÛŒØ± ÙÙˆÙ„Ø¯Ø± Ø¯ÛŒØªØ§Ø³Øª ØªÙ‚Ø³ÛŒÙ…â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ§Ù‡ Corn Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯
base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data/Wheat"

# Ù¾ÛŒÙ…Ø§ÛŒØ´ ÙÙˆÙ„Ø¯Ø±Ù‡Ø§ÛŒ TrainØŒ Validation Ùˆ Test Ùˆ Ø´Ù…Ø§Ø±Ø´ ØªØµØ§ÙˆÛŒØ±
def check_data_structure(base_path):
    if not os.path.exists(base_path):
        print("Invalid base path. Please check the folder path.")
        return

    for folder in ['Train', 'Validation', 'Test']:
        print(f"\n{folder} folder contents:")
        folder_path = os.path.join(base_path, folder)
        if os.path.isdir(folder_path):
            for disease in sorted(os.listdir(folder_path)):
                disease_path = os.path.join(folder_path, disease)
                if os.path.isdir(disease_path):
                    image_count = len([file for file in os.listdir(disease_path) if os.path.isfile(os.path.join(disease_path, file)) and file.lower().endswith(('.jpg', '.png', '.jpeg'))])
                    print(f"  {disease}: {image_count} images")

# Ø§Ø¬Ø±Ø§
check_data_structure(base_path)

import os
import shutil

# ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù ÙÙˆÙ„Ø¯Ø±Ù‡Ø§ Ùˆ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ Ø¢Ù†Ù‡Ø§
def remove_folders(base_path):
    for folder in ['Train', 'Validation', 'Test']:
        folder_path = os.path.join(base_path, folder)
        if os.path.exists(folder_path):
            shutil.rmtree(folder_path)  # Ø­Ø°Ù ÙÙˆÙ„Ø¯Ø± Ùˆ Ù…Ø­ØªÙˆØ§ÛŒ Ø¯Ø§Ø®Ù„ Ø¢Ù†
            print(f"Deleted {folder} folder.")

# Ù…Ø³ÛŒØ± ÙÙˆÙ„Ø¯Ø± Ø¯ÛŒØªØ§Ø³Øª ØªÙ‚Ø³ÛŒÙ…â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ§Ù‡ Tomato
base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data/Wheat"

# Ø­Ø°Ù ÙÙˆÙ„Ø¯Ø±Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
remove_folders(base_path)

# Ø§Ú©Ù†ÙˆÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú©Ø¯ ØªÙ‚Ø³ÛŒÙ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯:
# Ù†Ø³Ø¨Øªâ€ŒÙ‡Ø§ÛŒ ØªÙ‚Ø³ÛŒÙ…â€ŒØ¨Ù†Ø¯ÛŒ
test_ratio = 0.15
val_ratio = 0.15

# ØªØ§Ø¨Ø¹ ØªÙ‚Ø³ÛŒÙ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
def split_data_for_plant(plant_path, output_base_path):
    if not os.path.exists(plant_path):
        print("Invalid plant path. Please check the folder path.")
        return

    plant_name = os.path.basename(plant_path)
    output_path = os.path.join(output_base_path, plant_name)
    train_path = os.path.join(output_path, "Train")
    val_path = os.path.join(output_path, "Validation")
    test_path = os.path.join(output_path, "Test")

    for folder in [train_path, val_path, test_path]:
        os.makedirs(folder, exist_ok=True)

    print(f"Processing plant: {plant_name}")
    for disease in sorted(os.listdir(plant_path)):
        disease_path = os.path.join(plant_path, disease)
        if os.path.isdir(disease_path):
            files = [f for f in os.listdir(disease_path)
                     if os.path.isfile(os.path.join(disease_path, f)) and f.lower().endswith(('.jpg', '.png', '.jpeg'))]
            random.shuffle(files)
            total_files = len(files)

            test_count = int(total_files * test_ratio)
            val_count = int(total_files * val_ratio)

            test_files = files[:test_count]
            val_files = files[test_count:test_count + val_count]
            train_files = files[test_count + val_count:]

            for file_set, target_path in zip([train_files, val_files, test_files], [train_path, val_path, test_path]):
                disease_output_path = os.path.join(target_path, disease)
                os.makedirs(disease_output_path, exist_ok=True)
                for file in file_set:
                    shutil.copy(os.path.join(disease_path, file), os.path.join(disease_output_path, file))

            print(f"  {disease}: Train={len(train_files)}, Validation={len(val_files)}, Test={len(test_files)}")

# Ù…Ø³ÛŒØ± Ú¯ÛŒØ§Ù‡ Ùˆ ÙÙˆÙ„Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ
corn_path = "/content/drive/My Drive/plant-disease-detection/Plant Disease Detection/Wheat"
output_base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data"

# Ø§Ø¬Ø±Ø§
split_data_for_plant(corn_path, output_base_path)

import os

# Ù…Ø³ÛŒØ± ÙÙˆÙ„Ø¯Ø± Ø¯ÛŒØªØ§Ø³Øª ØªÙ‚Ø³ÛŒÙ…â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ§Ù‡ Tomato
base_path = "/content/drive/My Drive/plant-disease-detection/Processed Data/Wheat"

# ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§Ø±Ø´ ØªØµØ§ÙˆÛŒØ± Ø¯Ø± Ù‡Ø± Ø¯Ø³ØªÙ‡
def check_data_structure(base_path):
    if not os.path.exists(base_path):
        print("Invalid base path. Please check the folder path.")
        return

    for folder in ['Train', 'Validation', 'Test']:
        print(f"\n{folder} folder contents:")
        folder_path = os.path.join(base_path, folder)
        if os.path.isdir(folder_path):
            for disease in sorted(os.listdir(folder_path)):
                disease_path = os.path.join(folder_path, disease)
                if os.path.isdir(disease_path):
                    image_count = len([file for file in os.listdir(disease_path) if os.path.isfile(os.path.join(disease_path, file)) and file.lower().endswith(('.jpg', '.png', '.jpeg'))])
                    print(f"  {disease}: {image_count} images")

# Ø§Ø¬Ø±Ø§
check_data_structure(base_path)

import tensorflow as tf
from tensorflow.keras.applications import MobileNetV2
from tensorflow.keras import layers, models
from tensorflow.keras.preprocessing.image import ImageDataGenerator

# Ù…Ø³ÛŒØ± ÙÙˆÙ„Ø¯Ø±Ù‡Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
train_dir = "/content/drive/My Drive/plant-disease-detection/Processed Data/Wheat/Train"
val_dir = "/content/drive/My Drive/plant-disease-detection/Processed Data/Wheat/Validation"
test_dir = "/content/drive/My Drive/plant-disease-detection/Processed Data/Wheat/Test"

# Ø§ÛŒØ¬Ø§Ø¯ ImageDataGenerators Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒØŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ùˆ ØªØ³Øª
train_datagen = ImageDataGenerator(rescale=1./255, rotation_range=30, width_shift_range=0.2,
                                   height_shift_range=0.2, shear_range=0.2, zoom_range=0.2,
                                   horizontal_flip=True, fill_mode='nearest')

val_datagen = ImageDataGenerator(rescale=1./255)
test_datagen = ImageDataGenerator(rescale=1./255)

train_generator = train_datagen.flow_from_directory(train_dir, target_size=(224, 224), batch_size=32, class_mode='categorical')
val_generator = val_datagen.flow_from_directory(val_dir, target_size=(224, 224), batch_size=32, class_mode='categorical')
test_generator = test_datagen.flow_from_directory(test_dir, target_size=(224, 224), batch_size=32, class_mode='categorical')

# Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„ MobileNetV2 Ø§Ø² Ù¾ÛŒØ´ Ø¢Ù…ÙˆØ²Ø´â€ŒØ¯ÛŒØ¯Ù‡
base_model = MobileNetV2(weights='imagenet', include_top=False, input_shape=(224, 224, 3))

# Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ù…Ø¯Ù„
model = models.Sequential()
model.add(base_model)
model.add(layers.GlobalAveragePooling2D())  # Ú©Ø§Ù‡Ø´ Ø§Ø¨Ø¹Ø§Ø¯ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
model.add(layers.Dense(512, activation='relu'))  # Ù„Ø§ÛŒÙ‡ Fully Connected
model.add(layers.Dense(train_generator.num_classes, activation='softmax'))  # ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ Ù…Ø·Ø§Ø¨Ù‚ Ø¨Ø§ Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§

# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø¯Ù„
base_model.trainable = False  # Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¢Ù…ÙˆØ²Ø´ Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒØ¢Ù…ÙˆØ²Ø´ Ø¯ÛŒØ¯Ù‡

model.compile(optimizer='adam', loss='categorical_crossentropy', metrics=['accuracy'])

# Ø¢Ù…ÙˆØ²Ø´ Ù…Ø¯Ù„
history = model.fit(train_generator, epochs=10, validation_data=val_generator)

# Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ù…Ø¯Ù„ Ø±ÙˆÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª
test_loss, test_accuracy = model.evaluate(test_generator)
print(f"Test accuracy: {test_accuracy * 100:.2f}%")

# Ø°Ø®ÛŒØ±Ù‡ Ù…Ø¯Ù„ Ø¨Ù‡ ØµÙˆØ±Øª HDF5
model.save("/content/drive/My Drive/plant-disease-detection/models/Wheat_plant_disease_model.h5")
print("Model saved successfully!")

import os

# Ù…Ø´Ø®Øµ Ú©Ø±Ø¯Ù† ÙÙˆÙ„Ø¯Ø± Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ
model_folder = "/content/drive/My Drive/plant-disease-detection/models"

# Ù„ÛŒØ³Øª Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ Ù¾ÙˆØ´Ù‡
model_files = [f for f in os.listdir(model_folder) if f.endswith('.h5')]

# Ù†Ù…Ø§ÛŒØ´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
print("Model files found:")
for file in model_files:
    print(f"- {file}")

import numpy as np
import matplotlib.pyplot as plt
from sklearn.metrics import confusion_matrix, ConfusionMatrixDisplay


y_pred = model.predict(test_generator)
y_pred_classes = np.argmax(y_pred, axis=1)


y_true = test_generator.classes

# Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¨Ø¹Ø§Ø¯ y_true Ùˆ y_pred_classes
if len(y_true) != len(y_pred_classes):
    print("Mismatch in y_true and y_pred_classes lengths!")
else:
    # Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø§ØªØ±ÛŒØ³ Ø³Ø±Ø¯Ø±Ú¯Ù…ÛŒ
    cm = confusion_matrix(y_true, y_pred_classes)
    class_names = list(test_generator.class_indices.keys())  # Ù†Ø§Ù… Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§

    # Ø±Ø³Ù… Ù…Ø§ØªØ±ÛŒØ³ Ø³Ø±Ø¯Ø±Ú¯Ù…ÛŒ
    disp = ConfusionMatrixDisplay(confusion_matrix=cm, display_labels=class_names)
    disp.plot(cmap=plt.cm.Blues, xticks_rotation="vertical")
    plt.title("Confusion Matrix")
    plt.show()

"""ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ"""

from google.colab import files
from tensorflow.keras.models import load_model
from tensorflow.keras.preprocessing.image import load_img, img_to_array
import numpy as np
import matplotlib.pyplot as plt

# ØªØ¹Ø±ÛŒÙ Ù…Ø¯Ù„â€ŒÙ‡Ø§ØŒ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ Ùˆ Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú¯ÛŒØ§Ù‡
models = {
    "Corn": {
    "model_path": "/content/drive/My Drive/plant-disease-detection/models/corn_plant_disease_model.h5",
    "class_names": ['common_rust', 'grey_leaf_spot', 'healthy', 'northern_leaf_blight'],
    "solutions": {
        'healthy': "Ú¯ÛŒØ§Ù‡ Ø´Ù…Ø§ Ø³Ø§Ù„Ù… Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯.",
        'grey_leaf_spot': "Ú©Ø§Ù‡Ø´ Ø±Ø·ÙˆØ¨Øª Ø¨Ø±Ú¯â€ŒÙ‡Ø§ Ø¨Ø§ Ø¢Ø¨ÛŒØ§Ø±ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ùˆ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¢Ø¨ÛŒØ§Ø±ÛŒ Ø¨Ø§Ø±Ø§Ù†ÛŒØŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‚Ø§Ø±Ú†â€ŒÚ©Ø´â€ŒÙ‡Ø§ÛŒÛŒ Ù…Ø§Ù†Ù†Ø¯ Ù…Ø§Ù†Ú©ÙˆØ²Ø¨ØŒ ÙÙ„ÙˆÚ©ÙˆÙ†Ø§Ø²ÙˆÙ„ ÛŒØ§ Ú©Ù„Ø±ÙˆØªØ§Ù„ÙˆÙ†ÛŒÙ„",
        'common_rust': "Ø¢Ø¨ÛŒØ§Ø±ÛŒ Ù‚Ø·Ø±Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù‡Ø´ Ø±Ø·ÙˆØ¨Øª Ø±ÙˆÛŒ Ø¨Ø±Ú¯â€ŒÙ‡Ø§ØŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‚Ø§Ø±Ú†â€ŒÚ©Ø´â€ŒÙ‡Ø§ÛŒ ØªÙ…Ø§Ø³ÛŒ Ù…Ø§Ù†Ù†Ø¯ Ù¾Ø±ÙˆÙ¾ÛŒÚ©ÙˆÙ†Ø§Ø²ÙˆÙ„ ÛŒØ§ ÙÙ„ÙˆÚ©ÙˆÙ†Ø§Ø²ÙˆÙ„",
        'northern_leaf_blight': "Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‚Ø§Ø±Ú†â€ŒÚ©Ø´â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…ÛŒÚ© Ù…Ø§Ù†Ù†Ø¯ Ù…ØªØ§Ù„Ø§Ú©Ø³ÛŒÙ„ ÛŒØ§ ÙÙˆØ²Ø§Ø±ÛŒÙˆÙ…ØŒ Ø­Ø°Ù Ø¨Ø±Ú¯â€ŒÙ‡Ø§ÛŒ Ø¢Ù„ÙˆØ¯Ù‡ Ùˆ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø±Ø´Ø¯ Ø¢Ù†â€ŒÙ‡Ø§"
      }
    },
    "Tomato": {
        "model_path": "/content/drive/My Drive/plant-disease-detection/models/Tomato_plant_disease_model.h5",
        "class_names": [
            'Tomato_Bacterial_spot', 'Tomato_Early_blight', 'Tomato_Late_blight',
            'Tomato_Leaf_Mold', 'Tomato_Septoria_leaf_spot', 'Tomato_Spider_mites_Two_spotted_spider_mite',
            'Tomato__Target_Spot', 'Tomato__Tomato_YellowLeaf__Curl_Virus',
            'Tomato_healthy'
        ],
        "solutions": {
            'Tomato_Healthy': "Ú¯ÛŒØ§Ù‡ Ø´Ù…Ø§ Ø³Ø§Ù„Ù… Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯.",
            'Tomato__Target_Spot': "ØªÙ†Ø§ÙˆØ¨ Ø²Ø±Ø§Ø¹ÛŒØŒ Ø¢Ø¨ÛŒØ§Ø±ÛŒ Ù‚Ø·Ø±Ù‡â€ŒØ§ÛŒØŒ Ù‚Ø§Ø±Ú†â€ŒÚ©Ø´â€ŒÙ‡Ø§ÛŒÛŒ Ù…Ø§Ù†Ù†Ø¯ Ú©Ù„Ø±ÙˆØªØ§Ù„ÙˆÙ†ÛŒÙ„.",
            'Tomato__Tomato_YellowLeaf__Curl_Virus': "Ú©Ù†ØªØ±Ù„ Ù…Ú¯Ø³ Ø³ÙÛŒØ¯ Ø¨Ø§ Ø­Ø´Ø±Ù‡â€ŒÚ©Ø´â€ŒÙ‡Ø§ Ùˆ Ù¾ÙˆØ´Ø§Ù†Ø¯Ù† Ø¨ÙˆØªÙ‡â€ŒÙ‡Ø§.",
            'Tomato_Bacterial_spot': "Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¢Ø¨ÛŒØ§Ø±ÛŒ Ø¨Ø§Ø±Ø§Ù†ÛŒØŒ ØªØ±Ú©ÛŒØ¨Ø§Øª Ù…Ø³ÛŒ.",
            'Tomato_Early_blight': "ØªÙ‡ÙˆÛŒÙ‡ Ù…Ù†Ø§Ø³Ø¨ØŒ Ù‚Ø§Ø±Ú†â€ŒÚ©Ø´â€ŒÙ‡Ø§ÛŒÛŒ Ù…Ø§Ù†Ù†Ø¯ Ù…Ø§Ù†Ú©ÙˆØ²Ø¨.",
            'Tomato_Late_blight': "Ø¶Ø¯Ø¹ÙÙˆÙ†ÛŒ Ø¨Ø°Ø±Ù‡Ø§ØŒ Ø­Ø°Ù Ø¨Ù‚Ø§ÛŒØ§ÛŒ Ú¯ÛŒØ§Ù‡ÛŒØŒ Ù‚Ø§Ø±Ú†â€ŒÚ©Ø´â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…ÛŒÚ©.",
            'Tomato_Leaf_Mold': "ØªÙ‡ÙˆÛŒÙ‡ Ù…Ù†Ø§Ø³Ø¨ØŒ Ù‚Ø§Ø±Ú†â€ŒÚ©Ø´â€ŒÙ‡Ø§ÛŒÛŒ Ù…Ø§Ù†Ù†Ø¯ Ú©Ù„Ø±ÙˆØªØ§Ù„ÙˆÙ†ÛŒÙ„.",
            'Tomato_Septoria_leaf_spot': "Ø­Ø°Ù Ø¨Ø±Ú¯â€ŒÙ‡Ø§ÛŒ Ø¢Ù„ÙˆØ¯Ù‡ØŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…Ø§Ù†Ú©ÙˆØ²Ø¨.",
            'Tomato_Spider_mites_Two_spotted_spider_mite': "Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ú©ÙØ´Ø¯ÙˆØ²Ú©â€ŒÙ‡Ø§ Ùˆ Ø¢ÙØªâ€ŒÚ©Ø´â€ŒÙ‡Ø§ÛŒ Ø·Ø¨ÛŒØ¹ÛŒ."
        }
    },
    "Rice": {
        "model_path": "/content/drive/My Drive/plant-disease-detection/models/Rice_plant_disease_model.h5",
        "class_names": ['Rice___Brown_Spot', 'Rice___Leaf_Blast', 'Rice___Neck_Blast', 'Rice_healthy'],
        "solutions": {
            'Rice_healthy': "Ú¯ÛŒØ§Ù‡ Ø´Ù…Ø§ Ø³Ø§Ù„Ù… Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯.",
            'Rice___Brown_Spot': "Ø±Ø¹Ø§ÛŒØª ÙØ§ØµÙ„Ù‡ Ú©Ø§Ø´Øª Ù…Ù†Ø§Ø³Ø¨ Ùˆ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØ±Ø§Ú©Ù… Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ú¯ÛŒØ§Ù‡Ø§Ù†ØŒ ØªÙ†Ø¸ÛŒÙ… Ø¢Ø¨ÛŒØ§Ø±ÛŒ Ø¨Ù‡â€ŒÚ¯ÙˆÙ†Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø±Ø·ÙˆØ¨Øª Ø§Ø¶Ø§ÙÛŒ Ø±ÙˆÛŒ Ø¨Ø±Ú¯â€ŒÙ‡Ø§ Ø¬Ù…Ø¹ Ù†Ø´ÙˆØ¯ØŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‚Ø§Ø±Ú†â€ŒÚ©Ø´â€ŒÙ‡Ø§ÛŒÛŒ Ù…Ø§Ù†Ù†Ø¯ Ù…Ø§Ù†Ú©ÙˆØ²Ø¨ØŒ Ù¾ÙØ±ÛŒØ¯Ø§Ø¨Ù† ÛŒØ§ ÙÙˆØ²Ø§Ø±ÛŒÙˆÙ…",
            'Rice___Leaf_Blast': "Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªÙ†Ø§ÙˆØ¨ Ø²Ø±Ø§Ø¹ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù‡Ø´ Ø¨Ù‚Ø§ÛŒ Ù¾Ø§ØªÙˆÚ˜Ù†â€ŒÙ‡Ø§ Ø¯Ø± Ø®Ø§Ú©ØŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¢Ø¨ÛŒØ§Ø±ÛŒ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ùˆ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ØªÙ‡ÙˆÛŒÙ‡ Ø®ÙˆØ¨ Ø¯Ø± Ù…Ø²Ø±Ø¹ØŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‚Ø§Ø±Ú†â€ŒÚ©Ø´â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…ÛŒÚ© Ù…Ø§Ù†Ù†Ø¯ Ù…ØªØ§Ù„Ø§Ú©Ø³ÛŒÙ„ ÛŒØ§ ÙÙˆØ²Ø§Ø±ÛŒÙˆÙ…",
            'Rice___Neck_Blast': "Ø±Ø¹Ø§ÛŒØª ÙØ§ØµÙ„Ù‡ Ú©Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ú¯Ø±Ø¯Ø´ Ù‡ÙˆØ§ Ùˆ Ú©Ø§Ù‡Ø´ Ø±Ø·ÙˆØ¨ØªØŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‚Ø§Ø±Ú†â€ŒÚ©Ø´â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…ÛŒÚ© Ù…Ø§Ù†Ù†Ø¯ Ù…ØªØ§Ù„Ø§Ú©Ø³ÛŒÙ„ ÛŒØ§ ØªØ±ÛŒÙÙ„ÙˆØ²ÙˆÙ„"
        }
    },
    "Wheat": {
    "model_path": "/content/drive/My Drive/plant-disease-detection/models/Wheat_plant_disease_model.h5",
    "class_names": [
        'Wheat___Brown_Rust', 'Wheat___Yellow_Rust', 'Wheat_healthy'
    ],
    "solutions": {
        'Wheat_healthy': "Ú¯ÛŒØ§Ù‡ Ø´Ù…Ø§ Ø³Ø§Ù„Ù… Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯.",
        'Wheat___Brown_Rust': "ØªÙ†Ø§ÙˆØ¨ Ø²Ø±Ø§Ø¹ÛŒ Ø¨Ø§ Ú¯ÛŒØ§Ù‡Ø§Ù†ÛŒ Ú©Ù‡ Ù…ÛŒØ²Ø¨Ø§Ù† Ø¨ÛŒÙ…Ø§Ø±ÛŒ Ù†ÛŒØ³ØªÙ†Ø¯ (Ù…Ø«Ù„Ø§Ù‹ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø­Ø¨ÙˆØ¨Ø§Øª)ØŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‚Ø§Ø±Ú†â€ŒÚ©Ø´â€ŒÙ‡Ø§ÛŒ ØªÙ…Ø§Ø³ÛŒ Ù…Ø§Ù†Ù†Ø¯ Ù¾Ø±ÙˆÙ¾ÛŒÚ©ÙˆÙ†Ø§Ø²ÙˆÙ„ ÛŒØ§ ÙÙ„ÙˆÚ©ÙˆÙ†Ø§Ø²ÙˆÙ„ØŒ Ø¯Ø± ØµÙˆØ±Øª Ø´ÛŒÙˆØ¹ Ú¯Ø³ØªØ±Ø¯Ù‡ØŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØ±Ú©ÛŒØ¨ Ù‚Ø§Ø±Ú†â€ŒÚ©Ø´â€ŒÙ‡Ø§ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ù…ØªÙ†Ø§ÙˆØ¨ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù‡Ø´ Ù…Ù‚Ø§ÙˆÙ…Øª Ù¾Ø§ØªÙˆÚ˜Ù†â€ŒÙ‡Ø§",
        'Wheat___Yellow_Rust': "Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ú©Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ú©Ø´Øª Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø§ ØªÙ‡ÙˆÛŒÙ‡ Ø®ÙˆØ¨ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø±Ø·ÙˆØ¨Øª Ø¨Ø§Ù„Ø§ØŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø²Ù…Ø§Ù† Ù…Ù†Ø§Ø³Ø¨ Ú©Ø§Ø´Øª Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø´ÛŒÙˆØ¹ Ø²ÙˆØ¯Ù‡Ù†Ú¯Ø§Ù… Ø¨ÛŒÙ…Ø§Ø±ÛŒØŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‚Ø§Ø±Ú†â€ŒÚ©Ø´â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…ÛŒÚ© Ùˆ ØªÙ…Ø§Ø³ÛŒ Ù…Ø§Ù†Ù†Ø¯ ØªØ±ÛŒÙÙ„ÙˆØ³ÙˆÙ„ Ùˆ Ù¾Ø±ÙˆÙ¾ÛŒÚ©ÙˆÙ†Ø§Ø²ÙˆÙ„"
      }
    },
}

# ØªØ§Ø¨Ø¹ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ ØªØµÙˆÛŒØ±
def predict_image(model, class_names, image_path):
    # Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ùˆ Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´ ØªØµÙˆÛŒØ±
    img = load_img(image_path, target_size=(224, 224))
    img_array = img_to_array(img) / 255.0
    img_array = np.expand_dims(img_array, axis=0)

    # Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ
    prediction = model.predict(img_array)
    predicted_class_index = np.argmax(prediction)
    confidence = prediction[0][predicted_class_index]

    return class_names[predicted_class_index], confidence

# Ø§Ù†ØªØ®Ø§Ø¨ Ú¯ÛŒØ§Ù‡
print("Ù„Ø·ÙØ§Ù‹ ÛŒÚ©ÛŒ Ø§Ø² Ú¯ÛŒØ§Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯: Corn, Tomato, Rice, Wheat")
plant_choice = input("Ø§Ù†ØªØ®Ø§Ø¨ Ú¯ÛŒØ§Ù‡: ").strip()

# Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ùˆ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„ Ù…Ø±ØªØ¨Ø·
if plant_choice in models:
    plant_info = models[plant_choice]
    model = load_model(plant_info["model_path"])
    print(f"Model for {plant_choice} loaded successfully!")

    # Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ ØªØµÙˆÛŒØ±
    print("Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ØªØµÙˆÛŒØ± Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯:")
    uploaded = files.upload()

    # Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬
    for filename in uploaded.keys():
        predicted_class, confidence = predict_image(model, plant_info["class_names"], filename)
        solution = plant_info["solutions"].get(predicted_class, "Ø±Ø§Ù‡â€ŒØ­Ù„ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.")

        print(f"Predicted Disease: {predicted_class} ({confidence:.2f}% confidence)")
        print(f"Solution: {solution}")

        # Ù†Ù…Ø§ÛŒØ´ ØªØµÙˆÛŒØ±
        img = load_img(filename)
        plt.imshow(img)
        plt.axis('off')
        plt.title(f"Disease: {predicted_class}\nConfidence: {confidence:.2f}")
        plt.show()

else:
    print("Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø§Ù…Ø¹ØªØ¨Ø±! Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.")